from pyktool import pemks
import pytest

data = b'''privatekey,rsakey
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-256-CBC,A7A5E01C2A2C61B9DA16434C4F809710

MIlxTCVZtjnALHvfmw8I+q4wwVmfeTaZVVT9KxBB8Zat1uf2mAoI5TtbzXPd+y7L
4YDLa4y6d2lp3+MyCAE+aqXntirIxcDUH17uFrTVmvRx225XxOEb8Jpqpo3ZEQGe
VdYee5cqD7J9fcW/DhvnpZkZXKkniKaLA9cgeya4u2F5Y4NuWoL5Hh2KK5Fg7T0F
U6r7B6gfHEpCQGy+aMPYvOtCiGo7G+oyBm2hfn7JsgFwOe6j7fXo7s5hA7urPMfH
bdhvom1xN9zV3mV6RknMOOYxxd2GmAgC2QEfci+eUqXcQ1O06ua0flG3wOkQjAU9
6zXPd6BNhWrCUx6HALroEljgqxPCM0fsLu7XyzkxT8QT6q6fpgp+bQR/eY0p4mB0
FdSBIeECcTwVYEiBIvn0LSufHmJ17KnU51JDYAy+Tn+s4pqg+88fRkHlNWvZwExA
gcBbHh0JuVJ0LjI1IB+YnyczWhHJlA6d7m0N2MFlsDCAOjUS7biFe0xqPvpP3yvw
7+Rpuh6Y3CvapNhVqs+68i7a89KH6OJT9upKg5YSCvZ9qw+GnSOXa1n0VLeeId3i
YCUVp891EqlPWH+58OnNrNF9lq0+IuX+bDMBJdetPyYqj/sFjz573xhJMBW0go0B
cbLzHsusuzpIvYRNdkLo0OL0+fV7XO+WjAMJ1JnoOVVM6n64vZ/de5JtlLiyNmch
r3gCOJcUntgDa+cPOxwoQ/uceTsESXMQTkPYZiC0Fq1HqzLQKMniIXeIc4CwQH4h
t/0Q1/qxNpHBPWIqcRQDcsE72eb4s9ebvsRBAG8QmeG6rePDnwtKutN42ktyI9oA
aM5sHupfYAqtNQKPrYDfy9U0J6zy8AzRdJgnPXK4AKd4libXVRXFmHgG9VTIn+Ut
b5+6kXPeWFG/sAZOORoUawM+xoRXrmJ022K4qX6M6nZCX+BCqDkCwUowCCVTHE7P
9JkZBLIyMsxYp0FOOvgO7FsTsRzNiN2VxYjINE7P3QvffzRy1OlmUx/6JSsGLnsp
vTvDXtyFSAciBb0Q+2pGxfkA8RpLEWSPr/F63yHTcbEU5jauu0Q8LA936tcIHVqY
hBmwiTdXmhQ72vAtgUVr4neAtDWhhu87Ps4CfQQ/oqKegUlEpFQtpjPzg9cwlMpj
ZJBVCophpPXqOqdHxvxJmWkxmfypVPgZFncYzA2hS3VE6hPnvTCgMEeWAH3fY3Y9
HWJIh8cd0qWNkv8Tx4GlkRp9D+MpLmJRa54r0FASJQ99yCy8tL8ThX2J3ul3nu1x
lmOQloqkcwUiioD3yB0VFh3ViXGguOrUKfztyGwpm+jlMz9f4O33qw2sgr2jFh5V
MYYcCgoW4lwxFrtcxsnRtEFK7XNNZoxEX3oBdEAjPz/RvGYxBo0VVIU5LR+bZrAf
13cvVEP7xQ9bx9+C3EFv2B9BcxCa0xHhAWY4cN5xfA9Dr5V2rCnyHrbAmdkR/84R
vfDdnszd/BOSjcpFdUyNIwEG+YRAx76iKs55aoIYBIyqekLw3OkmZYaRB3w6c6Cm
pKY0QVn0vkrP0CKyyj8IlcNq4SqCy2OMeGOJwOKLdP4xTIcuKp2Zl6SyhqCJY6a/
-----END RSA PRIVATE KEY-----
chain,rsakey
-----BEGIN CERTIFICATE-----
MIIC/TCCAeWgAwIBAgIUaOUSJ5Sh2T/wh0KiywrI7PKQzfIwDQYJKoZIhvcNAQEL
BQAwDjEMMAoGA1UEAwwDUlNBMB4XDTE5MDUxODA3MTUxNloXDTE5MDgyNjA3MTUx
NlowDjEMMAoGA1UEAwwDUlNBMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC
AQEA3fgamq2NLjfEdiXxyZOSN24VeTDaJY4juKY3JQ3T6iqBcJkxe1OA1P9CUmTR
GYy0dZ4puSfLmPP2qhbNLsM648R0XEfoU4i7uafKBIZG/MG+rYHkXJa8sVKrxCqC
ud87TUZH2vx0d3Z+yXd5ybDtqKKqn9pl12aw6dXV7tC3tGVYHwbUG8eun+iKdKLN
VGd2CaHYHGTVChJyhSBeeLf4ZvKO9NgVCUm98lMhl4DVW8Ew2ayXXsDVSP8nKi1F
ACtSXW8RZgszyUEDRKZS8KGYGsP9Rr+H6ZtvvQw7hgsEPIairwkLqC26xDDQpxs3
JEAONolbE1Cwv4ThOe70Z73LiwIDAQABo1MwUTAdBgNVHQ4EFgQUiQEtBbm1uphH
GsTSD4lGbqPb+MAwHwYDVR0jBBgwFoAUiQEtBbm1uphHGsTSD4lGbqPb+MAwDwYD
VR0TAQH/BAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEAHiyE/CHiVjdMuwRPJrE5
u6S+iPkUIPBaccyFzJ0Uwje8Vz6Dja9Ly+n5OIW7BWzqhCfBRFJopsppfn9hVB9I
I5ScHmENLY6ypKEB6zLa8x4UCBEqAQ99EysCU/2dB7SnsqYoMWMROYZXIhn6wSLy
DtjV9Do6hh7CnfB5a0ihUfczmY2RTnnbI9IPD0UwDSrjbtqSU5iVfCVeLc1KicfY
zUD3VTT7K9OHn1k4WdBhqIHxFeluj+sowfG59tuiUVEqhat/SMTX5mb8rcIPhOQJ
cxEMGD1WMsvAPeapFe3vhMFpTG5JXQGqwacaUUqVTXef3F6/o/z3CreS/5mQw/lR
nA==
-----END CERTIFICATE-----
'''

data2 = b'''privatekey,eckey
-----BEGIN EC PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-256-CBC,DAAC871CA1845FB80C8331D3B8A42726

0AKlaDsHC+hz9/DEzo895oocKnpJmGFPRHYgfuS+JzEDn7gvXiqSJaVN3nXe8SCy
PFi6T20Q94qWlOShceg0oCi9TFDKOP8+GN4qkzc3GmN8cziYkbNCV3gTdaYFnYT5
h+42LgfaU95XyXqn3bFgRVbCDyU5mMCRr+tQA3BHDKc=
-----END EC PRIVATE KEY-----
chain,eckey
-----BEGIN CERTIFICATE-----
MIIBbzCCARWgAwIBAgIUVnO8Eik+CpBfZuofbo3uLsICiZ8wCgYIKoZIzj0EAwIw
DTELMAkGA1UEAwwCRUMwHhcNMTkwNTE4MDcyMTM4WhcNMTkwODI2MDcyMTM4WjAN
MQswCQYDVQQDDAJFQzBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABB4GyTmt9sjI
TDBHC9KJCm/fDkcY7N5e3jwjRSYjU9Lkx8dtUVZ3O2+d7YXzbx+JcJT0/+Y+a81u
q9yAjvec8eujUzBRMB0GA1UdDgQWBBS5My1a7NmGiuLDwQ0xDiRe8QUb9TAfBgNV
HSMEGDAWgBS5My1a7NmGiuLDwQ0xDiRe8QUb9TAPBgNVHRMBAf8EBTADAQH/MAoG
CCqGSM49BAMCA0gAMEUCIQDu2vEuwgZkXGTdhMOrOBt/cBOZIWRZyycveTW+//L7
bAIgXDkWitVAOMR2a2ZlJhGK8DJUOx6qi2ptEe7y+iIo2H8=
-----END CERTIFICATE-----
privatekey,eckey2
-----BEGIN EC PRIVATE KEY-----
MHcCAQEEIBt1pNPU8LDCOrG585A7rMUwWuZO53X+lB6VntueySvMoAoGCCqGSM49
AwEHoUQDQgAEHgbJOa32yMhMMEcL0okKb98ORxjs3l7ePCNFJiNT0uTHx21RVnc7
b53thfNvH4lwlPT/5j5rzW6r3ICO95zx6w==
-----END EC PRIVATE KEY-----
chain,eckey2
-----BEGIN CERTIFICATE-----
MIIBbzCCARWgAwIBAgIUVnO8Eik+CpBfZuofbo3uLsICiZ8wCgYIKoZIzj0EAwIw
DTELMAkGA1UEAwwCRUMwHhcNMTkwNTE4MDcyMTM4WhcNMTkwODI2MDcyMTM4WjAN
MQswCQYDVQQDDAJFQzBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABB4GyTmt9sjI
TDBHC9KJCm/fDkcY7N5e3jwjRSYjU9Lkx8dtUVZ3O2+d7YXzbx+JcJT0/+Y+a81u
q9yAjvec8eujUzBRMB0GA1UdDgQWBBS5My1a7NmGiuLDwQ0xDiRe8QUb9TAfBgNV
HSMEGDAWgBS5My1a7NmGiuLDwQ0xDiRe8QUb9TAPBgNVHRMBAf8EBTADAQH/MAoG
CCqGSM49BAMCA0gAMEUCIQDu2vEuwgZkXGTdhMOrOBt/cBOZIWRZyycveTW+//L7
bAIgXDkWitVAOMR2a2ZlJhGK8DJUOx6qi2ptEe7y+iIo2H8=
-----END CERTIFICATE-----
'''


def test_rsa_private_key():

    ks = pemks.PEMKS()

    ks.load_s(data, b'changeit')

    assert 'rsakey' in ks.index


def test_ec_private_key():

    ks = pemks.PEMKS()

    ks.load_s(data2, b'changeit')

    assert 'eckey' in ks.index
    assert 'eckey2' in ks.index

    with pytest.raises(ValueError):
        ks.load_s(data2, b'changeitx')
